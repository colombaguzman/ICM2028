<!DOCTYPE html>

<html>
  
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>Calculadora de Vigas</title>
    <link rel="icon" type="image/x-icon" href="./favicon.png">
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <link rel='stylesheet' type='text/css' media='screen' href='https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.min.css'>
    <link rel="icon" type="image/png" href="https://user-images.githubusercontent.com/49681382/166738771-d0c26557-426c-4688-9641-8db5e6b08348.png" />
    <script defer src="https://pyscript.net/alpha/pyscript.js"></script>
    <py-env>
- matplotlib
- numpy
    </py-env>

</head>

<body>

    <div hidden id="evtMsg">0</div>
<!-- Header -->
<section class="hero is-primary is-small">
    <div class="hero-body">
        <p class="title is-3">Calculadora de momentos y esfuerzos de corte interno en vigas <span class="tag is-white">v.1</span></p>
        <p class="subtitle is-6">
            ICM2028 - Mecánica de materiales
        </p>
    </div>
</section>

<div class="container is-fullhd">

<p class="title is-3">Momento y Esfuerzo de Corte en vigas</p>


<div class="columns" style="margin-top:45px">
    <div class="column is-one-fourth"> 
        <div class="field">
            <label class="label">Largo de la viga</label>
            <div class="control">
                <input type="text" id="largo"/>
            </div>
        </div>


    <!-- Apoyo 1 -->
        <!-- <div class="field"> -->
        <label class="label">Apoyo 1 </label>

        <div class="field">
            <label class="label">Posición</label>
            <input type="text" id="a1pos"/>
        </div>

        <label class="label">Tipo de Restricción</label>
        <div class="field has-addons">
            <div class="control is-expanded">
                <div class="select">
                <select name="operation" id="a1res">
                    <option value="1">Fuerza</option>
                    <option value="2">Momento</option>
                </select>
                </div>
            </div>
        </div>


    <!-- Apoyo 2 -->
        <label class="label">Apoyo 2 </label>

        <div class="field">
            <label class="label">Posición</label>
            <input type="text" id="a2pos"/>
        </div>
    
        <label class="label">Tipo de Restricción</label>
        <div class="field has-addons">
            <div class="control is-expanded">
                <div class="select">
                <select name="operation" id="a2res">
                    <option value="1">Fuerza</option>
                    <option value="2">Momento</option>
                </select>
                </div>
            </div>
        </div>
     </div>   


    <!-- Carga 1 -->
    <div class="column is-one-fourth">
  
        <label class="label">Carga 1</label>
        <label class="label">Tipo de carga</label>
        <div class="field has-addons">
            <div class="control is-expanded">
                <div class="select">
                <select name="operation" id="c1tipo">
                    <option value="0">Carga distribuida</option>
                    <option value="-1">Carga puntual</option>
                    <option value="-2">Momento puntual</option>
                </select>
                </div>
            </div>
        </div>


        <div class="field">
            <label class="label">Magnitud de carga</label>
            <input type="text" id="c1muli"/>
        </div>

        <div class="field">
            <label class="label">Inicio de Carga</label>
            <input type="text" id="c1ini"/>     
        </div>

        <div class="field">
            <label class="label">Fin de Carga </label>
            <input type="text" placeholder="Solo cargas distribuidas" id="c1fin"/>     
        </div>
    </div>
    <!-- Carga 2 -->
    <div class="column is-one-fourth">
    <label class="label">Carga 2</label>
    <label class="label">Tipo de carga</label>
    <div class="field has-addons">
        <div class="control is-expanded">
            <div class="select">
            <select name="operation" id="c2tipo">
                <option value="1">Sin Carga</option>
                <option value="0">Carga distribuida</option>
                <option value="-1">Carga puntual</option>
                <option value="-2">Momento puntual</option>
            </select>
            </div>
        </div>
    </div>

    <div class="field">
        <label class="label">Magnitud de carga</label>
        <input type="text" id="c2muli"/>
    </div>

    <div class="field">
        <label class="label">Inicio de Carga</label>
        <input type="text" id="c2ini"/>     
    </div>

    <div class="field">
        <label class="label">Fin de Carga</label>
        <input type="text" placeholder="Solo cargas distribuidas" id="c2fin"/>     
    </div>
    </div>

    <!-- Carga 3 -->
    <div class="column is-one-fourth">
    <label class="label">Carga 3</label>
    <label class="label">Tipo de carga</label>
    <div class="field has-addons">
        <div class="control is-expanded">
            <div class="select">
            <select name="operation" id="c3tipo">
                <option value="1">Sin Carga</option>
                <option value="0">Carga distribuida</option>
                <option value="-1">Carga puntual</option>
                <option value="-2">Momento puntual</option>
            </select>
            </div>
        </div>
    </div>

    <div class="field">
        <label class="label">Magnitud de carga</label>
        <input type="text" id="c3muli"/>
    </div>

    <div class="field">
        <label class="label">Inicio de Carga</label>
        <input type="text" id="c3ini"/>     
    </div>

    <div class="field">
        <label class="label">Fin de Carga</label>
        <input type="text" placeholder="Solo cargas distribuidas" id="c3fin"/>     
    </div>

    <!-- Botón -->
      
    <button id="plot-button" type="button" class="button is-primary" onClick="document.getElementById('evtMsg').innerHTML=100" class="button">Plot</button>
    </div>
    </div>


    <!-- </div> -->
  
  <hr>
<!-- <div class="column is-one-half"> -->
  <div id="output"></div>
<!-- </div> -->
  
</div> 
</div>
  <!-- </div>
</div> -->
  
<!-- Footer -->
<footer class="footer">
    <div class="content has-text-centered">
        <p>
            Desarrollado por <strong>Carlos Cabrera & Francisco Sahli</strong></a>
        </p>
    </div>
</footer>

<py-script>

import matplotlib.pyplot as plt
import numpy as np
import asyncio
from pyodide import create_proxy

## INPUTS HTML ##
  
largo_element = Element("largo")
a1pos_element = Element("a1pos")
a1res_element = Element("a1res") 
a2pos_element = Element("a2pos")
a2res_element = Element("a2res")
c1tipo_element = Element("c1tipo")
c1muli_element = Element("c1muli")
c1ini_element = Element("c1ini")
c1fin_element = Element("c1fin")
c2tipo_element = Element("c2tipo")
c2muli_element = Element("c2muli")
c2ini_element = Element("c2ini")
c2fin_element = Element("c2fin")
c3tipo_element = Element("c3tipo")
c3muli_element = Element("c3muli")
c3ini_element = Element("c3ini")
c3fin_element = Element("c3fin")
output = Element("output")
  
## BOTÓN ##
  
def Setup_Button_Listeners():
    btnList = document.querySelectorAll(".button")
    for i in range(len(btnList)):
        e = document.getElementById(btnList[i].id)
        btn_event = create_proxy(Process_Button)
        e.addEventListener("click", btn_event)
        
async def Process_Button(event):
    if document.getElementById("evtMsg").innerHTML == '100': 
        fig = await plot_it()
        output.write(fig)

## CLASES ##
  
class Singularity:
    def __init__(self,w0, a, order, coeff = 1):
        self.w0 = w0
        self.a = a
        self.order = order
        self.coeff = coeff
    def __call__(self, x):
        if self.order >= 0:
            return self.w0*(x-self.a)**self.order*(x>self.a)*self.coeff 
        else:
            return np.zeros_like(x) # functions of negative order can only be integrated
    def integrate(self):
        if self.order < 0:
            return Singularity(self.w0, self.a, self.order + 1)
        else:
            return Singularity(self.w0, self.a, self.order + 1, coeff = 1.0/(self.order + 1))

## FUNCIÓN ##
          
async def plot_it(*args, **kwargs):

    L = float(largo_element.value)
    a11 = int(a1res_element.value)
    a12 = float(a1pos_element.value)
    a21 = int(a2res_element.value)
    a22 = float(a2pos_element.value)
    c11 = float(c1muli_element.value)
    c12 = float(c1ini_element.value)
    c13 = int(c1tipo_element.value)
    c23 = int(c2tipo_element.value)
    c33 = int(c3tipo_element.value)
    A1 = [a11,a12]
    A2 = [a21,a22]
        
    x = np.linspace(0,L, 1000)
    qs = []
    if c13 == 0:
      c14 = float(c1fin_element.value)
      qs.append([c11,c12,c13])
      qs.append([-c11,c14,c13])
    else:
      qs.append([c11,c12,c13])

    if c23 == 0:
      c21 = float(c2muli_element.value)
      c22 = float(c2ini_element.value)
      c24 = float(c1fin_element.value)
      qs.append([c21,c22,c23])
      qs.append([-c21,c24,c23])
    elif c23 == 1:
      pass
    else:
      c21 = float(c2muli_element.value)
      c22 = float(c2ini_element.value)
      qs.append([c21,c22,c23])
          
    if c33 == 0:
      c31 = float(c3muli_element.value)
      c32 = float(c3ini_element.value)
      c34 = float(c3fin_element.value)
      qs.append([c31,c32,c33])
      qs.append([-c31,c34,c33])
    elif c33 == 1:
      pass

    else:
      c31 = float(c3muli_element.value)
      c32 = float(c3ini_element.value)
      qs.append([c31,c32,c33])
        
    Qs = []

    for q in qs:
        Qs.append(Singularity(q[0],q[1],q[2]))

    A=np.zeros((2,2))
    
    if A1[0]==1:
        A[0,0]=1
        A[1,0]=A1[1]
    else:
        A[1,0]=1
    
    if A2[0]==1:
        A[0,1]=1
        A[1,1]=A2[1]
    else:
        A[1,1]=1

    w = 0
    wx = 0
    for qi in Qs:
        qi_int = qi.integrate()
        w += qi_int(L) - qi_int(0)
        wx += np.trapz(x*qi(x),x)
    f = np.array([w, wx])
    R=np.linalg.solve(A,f)

    qA1 = Singularity(-R[0], A1[1], -A1[0])
    qA2 = Singularity(-R[1], A2[1], -A2[0])
    Qs.append(qA1)
    Qs.append(qA2)
    Vs = []
    Ms = []

    for qi in Qs:
        Vs.append(qi.integrate())
        Ms.append(Vs[-1].integrate())

    V = 0
    M = 0
    for vi in Vs:
        V += vi(x)
        
    for mi in Ms:
        M -= mi(x)

    fig, ax = plt.subplots()

    ax.plot(x, V, linestyle='-', color='g', label='Corte')
    ax.set_xlabel("x")
    ax.set_ylabel("Corte")

    ax2=ax.twinx()
    ax2.plot(x, M, linestyle='-', color='r', label='Momento')
    ax2.set_ylabel("Momento")

    plt.title('Corte y Momento en vigas')
    plt.legend()
    fig
    return fig
    
Setup_Button_Listeners()

</py-script>
  
</body>
</html>
